(this["webpackJsonphireme-test-diagram"]=this["webpackJsonphireme-test-diagram"]||[]).push([[0],{10:function(e){e.exports=JSON.parse('{"b":10,"c":10,"d":100,"a":0.2}')},73:function(e,t,n){e.exports=n(87)},87:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),l=n(16),c=n.n(l),i=n(7),o=n(12),u=n(1),s=n(69),m=n(105),f=n(13),d=n.n(f),b=n(20),p=n(37),v=n(15),h=n(5),g=n(110),j=n(3),O=n.n(j),E=n(107),y=n(109),x=n(36),k=n(106),S=n(108),w=n(103),C=n(35),A=n(14),I=n.n(A),R=n(10),N=function e(t){var n,a=0;return(null===(n=t.children)||void 0===n?void 0:n.length)&&t.children.forEach((function(t){a+=(e(t)+t.sales*R.d)*R.a})),Math.round(a)},D=function(e){var t,n;if(Array.isArray(e)){var a=e.map((function(e){return parseInt(e)})),r=Object(i.a)(a,2);t=r[0],n=r[1]}else if("string"===typeof e){var l=e.split(",").map((function(e){return parseInt(e)})),c=Object(i.a)(l,2);t=c[0],n=c[1]}else t=e.x,n=e.y;return[t,n]},F={getAll:function(){var e=Object(v.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.next=3,I.a.iterate((function(e,n){t[n]=e})).then((function(){Object.keys(t).forEach((function(e){var n,a;t[e].children=null!==(n=null===(a=t[e].children)||void 0===a?void 0:a.map((function(e){return t[e]})))&&void 0!==n?n:[]}))}));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),update:function(e,t){return I.a.getItem(D(e).toString()).then((function(n){return I.a.setItem(D(e).toString(),"function"===typeof t?t(n):Object(h.a)(Object(h.a)({},n),t))}))},move:function(e,t){return I.a.getItem(D(e).toString()).then((function(e){return I.a.setItem(D(t).toString(),Object(h.a)(Object(h.a)({},e),{},{x:D(t)[0],y:D(t)[1]}))})).then((function(){return I.a.removeItem(D(e).toString())}))},add:function(e,t){return I.a.setItem(D(e).toString(),Object(h.a)(Object(h.a)({},t),{},{x:D(e)[0],y:D(e)[1]}))},delete:function(e){return I.a.removeItem(D(e).toString()).then((function(){return I.a.iterate((function(t,n){var a;return(null===(a=t.children)||void 0===a?void 0:a.includes(D(e).toString()))?{key:n,value:t}:void 0}))})).then((function(t){var n=t.key,a=t.value;return I.a.setItem(n,Object(h.a)(Object(h.a)({},a),{},{children:a.children.filter((function(t){return t!==D(e).toString()}))}))}))},replaceAll:function(e){return I.a.clear().then((function(){return Promise.all(Object.entries(e||{}).map((function(e){var t=Object(i.a)(e,2),n=t[0],a=t[1];return I.a.setItem(n,a)})))}))}},M=function(e){var t=e.friendValues,n=t.x,a=t.y,l=t.name,c=t.sales,i=e.submit,o=Object(C.a)({initialValues:{name:l,sales:c},onSubmit:function(){var e=Object(v.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.update([n,a],t);case 2:i();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onReset:i});return r.a.createElement(k.a,{onEsc:o.handleReset,onClickOutside:o.handleReset},r.a.createElement("form",{onChange:o.handleChange,onSubmit:o.handleSubmit,onReset:o.handleReset},r.a.createElement(s.a,{justify:"center"},r.a.createElement(S.a,{textAlign:"center",margin:"small"},"Edit Friend"),r.a.createElement(s.a,{margin:"xsmall"},r.a.createElement(w.a,{placeholder:"Name",name:"name",value:o.values.name,autoFocus:!0})),r.a.createElement(s.a,{margin:"xsmall"},r.a.createElement(w.a,{placeholder:"Sales",name:"sales",value:o.values.sales,type:"number"})),r.a.createElement(s.a,{direction:"row",justify:"center"},r.a.createElement(E.a,{label:"Cancel",type:"reset",margin:"small"}),r.a.createElement(E.a,{label:"Delete",onClick:function(){return window.confirm("Are you sure you want to delete this friend?")?F.delete([n,a]).then(i):null},margin:"small"}),r.a.createElement(E.a,{label:"Submit",type:"submit",margin:"small",primary:!0})))))};function P(){var e=Object(o.a)(["\n  background: white url(",") no-repeat center;\n  height: 36px;\n  width: 24px;\n  float: right;\n"]);return P=function(){return e},e}function T(){var e=Object(o.a)(["\n  opacity: 0.5;\n  border: ",";\n\n  :hover {\n    border-style: ",";\n  }\n"]);return T=function(){return e},e}function V(){var e=Object(o.a)(["\n  border-radius: 4px;\n  user-select: none;\n  overflow-wrap: break-word;\n  text-align: center;\n"]);return V=function(){return e},e}var B=Object(u.default)(s.a).attrs({background:"lightblue",pad:"xsmall",responsive:!1})(V()),J=Object(u.default)(s.a).attrs((function(e){return{background:e.isHovering?"black":"lightgray",margin:e.isHovering?"small":"medium",responsive:!1,round:"full"}}))(T(),(function(e){return"select"===e.stage?"1px dashed black":null}),(function(e){return"select"===e.stage?"solid":null})),$=Object(u.default)(E.a).attrs({title:"edit"})(P(),"/create-24px.svg"),H=O.a.shape({name:O.a.string.isRequired,sales:O.a.number.isRequired});H.children=O.a.arrayOf(H.isRequired);var L=function(e){var t=e.friend,n=e.stage,l=e.onEmptyClick,c=e.onFriendClick,o=e.onDrop,u=e.id,s=e.update,m=Object(a.useState)(!1),f=Object(i.a)(m,2),d=f[0],b=f[1],p=Object(a.useState)(!1),v=Object(i.a)(p,2),h=v[0],g=v[1],j=Object(a.useState)(!1),O=Object(i.a)(j,2),E=O[0],k=O[1];if(Object(a.useEffect)((function(){b(!1)}),[t]),t){var S,w=t.sales*R.d,C=N(t),A=null===(S=t.children)||void 0===S?void 0:S.map((function(e,n){var a=e.x-t.x,l=e.y-t.y,c=Array.from(Array(Math.max(Math.round(Math.pow(Math.pow(a,2)+Math.pow(l,2),.5)),3)),(function(){return null})).map((function(e,t,n){return[a/(n.length-1)*t*100,l/(n.length-1)*t*100]})).join(" ");return r.a.createElement("svg",{style:{position:"absolute",zIndex:-1,overflow:"visible"},key:n},r.a.createElement("defs",null,r.a.createElement("marker",{id:"t",markerWidth:"8",markerHeight:"8",orient:"auto",refY:"4"},r.a.createElement("path",{d:"M0,0 L8,4 0,8"}))),r.a.createElement("polyline",{markerMid:"url(#t)",points:c,stroke:"black"}))}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(y.a,{anchor:"center",margin:"auto",style:{maxWidth:"100%"}},A,r.a.createElement(B,{onClick:c,onDragEnd:function(){return g(!1)},onDragStart:function(e){g(!0),e.dataTransfer.setData("text",e.target.id)},draggable:"select"!==n,"data-for":"tooltip-".concat(u),"data-tip":!0,id:u},t.name)),h||"select"===n||E?null:r.a.createElement(x.a,{id:"tooltip-".concat(u),effect:"solid",delayHide:200,clickable:!0},r.a.createElement($,{onClick:function(){return k(!0)}}),r.a.createElement("div",null,r.a.createElement("div",null,"Name: ",t.name),r.a.createElement("div",null,"Sales: ",t.sales),r.a.createElement("div",null,"Sales profit: $",w),r.a.createElement("div",null,"Children's sales profit: $",C),r.a.createElement("div",null,"Total profit: $",w+C))),E?r.a.createElement(M,{friendValues:t,submit:function(){k(!1),s()}}):null)}return r.a.createElement(J,{onClick:l,stage:n,isHovering:d,onDragOver:function(e){b(!0),e.preventDefault()},onDragLeave:function(){return b(!1)},onDrop:o,id:u})};function _(){var e=Object(o.a)(["\n  max-width: 100%;\n  max-height: 100%;\n  overflow: scroll;\n"]);return _=function(){return e},e}var q=Object(u.default)(s.a)(_()),z=function(e){var t=e.stage,n=e.setNextFriend,l=e.setStage,c=Object(a.useState)({}),o=Object(i.a)(c,2),u=o[0],s=o[1],m=Object(a.useState)(null),f=Object(i.a)(m,2),j=f[0],O=f[1];Object(a.useEffect)((function(){"normal"!==t&&"select"!==t||F.getAll().then(s)}),[t,j]),console.log(u);var E=Array.from(Array(R.c),(function(e,t){return Array.from(Array(R.b),(function(e,n){return[n,t]}))})).flat();return r.a.createElement(q,{onScroll:function(e){return console.log(e.target.scrollTop,e.target.scrollLeft)}},r.a.createElement(g.a,{rows:Array.from(Array(R.c),(function(){return"100px"})),columns:Array.from(Array(R.b),(function(){return"100px"}))},E.map((function(e){return r.a.createElement(L,{friend:u[e],onEmptyClick:"select"===t?function(){n((function(t){return Object(h.a)(Object(h.a)({},t),{},{coords:e.toString()})})),l("input")}:null,onFriendClick:function(){"normal"===t&&(n((function(t){return Object(h.a)(Object(h.a)({},t),{},{parentCoords:e.toString()})})),l("select"))},onDrop:function(){var e=Object(v.a)(d.a.mark((function e(t){var n,a,r,l,c,o,s,m,f;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.dataTransfer.getData("text").split(",").map((function(e){return parseInt(e)})),a=Object(i.a)(n,2),r=a[0],l=a[1],c=t.target.id.split(",").map((function(e){return parseInt(e)})),o=Object(i.a)(c,2),s=o[0],m=o[1],console.log("dragging from:",r,l,"into:",s,m),r===s&&l===m||u[[s,m]]){e.next=11;break}return e.next=6,F.move([r,l],[s,m]);case 6:if(!(f=Object.values(u).find((function(e){return e.children.find((function(e){return e.x===r&&e.y===l}))})))){e.next=10;break}return e.next=10,F.update(f,(function(e){var t=e.children,n=Object(p.a)(e,["children"]);return Object(h.a)(Object(h.a)({},n),{},{children:[].concat(Object(b.a)(t.filter((function(e){return e!==[r,l].toString()}))),[[s,m].toString()])})}));case 10:O((function(e){return!e}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),update:function(){return O((function(e){return!e}))},id:e.toString(),stage:t,key:u[e]?"".concat(e,"-").concat(u[e].children):e})}))))},G=n(23),W=n(102),K=n(104);function U(){var e=Object(o.a)(["\n  max-width: 100%;\n  max-height: 100%;\n  overflow: scroll;\n"]);return U=function(){return e},e}var Y=Object(u.default)(s.a)(U()),Q=function(e){var t=e.stage,n=Object(a.useState)({}),l=Object(i.a)(n,2),c=l[0],o=l[1];Object(a.useEffect)((function(){"table"===t&&F.getAll().then(o)}),[t]),console.log(c);var u=Object(a.useCallback)((function(e){var t=e.target,n=t.name,a=t.value,r=n.split("."),l=Object(i.a)(r,2),u=l[0],s=l[1];a="sales"===s?Number(a):a,o(Object(h.a)(Object(h.a)({},c),{},Object(G.a)({},u,Object(h.a)(Object(h.a)({},c[u]),{},Object(G.a)({},s,a)))))}),[c]),m=Object(a.useCallback)(function(){var e=Object(v.a)(d.a.mark((function e(t){var n,a,r,l,c,o,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target,a=n.name,r=n.value,l=a.split("."),c=Object(i.a)(l,2),o=c[0],u=c[1],r="sales"===u?Number(r):r,e.next=5,F.update(o,Object(G.a)({},u,r));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),f=Object.entries(c).map((function(e){var t=Object(i.a)(e,2),n=t[0],a=t[1];return Object(h.a)(Object(h.a)({},a),{},{salesProfit:a.sales*R.d,childProfit:N(a),totalProfit:a.sales*R.d+N(a),key:n})}));return r.a.createElement(Y,null,r.a.createElement(W.a,{columns:[{property:"name",header:"Name",render:function(e){return"tableEdit"===t?r.a.createElement(w.a,{value:c[e.key].name,name:"".concat(e.key,".name"),onChange:u,onBlur:m}):e.name}},{property:"sales",header:"Sales",render:function(e){return"tableEdit"===t?r.a.createElement(w.a,{value:c[e.key].sales,name:"".concat(e.key,".sales"),onChange:u,onBlur:m}):r.a.createElement(r.a.Fragment,null,r.a.createElement(s.a,{"data-tip":e.sales+" sales"},r.a.createElement(K.a,{values:[{value:e.sales}],max:Math.max.apply(Math,Object(b.a)(Object.values(c).map((function(e){return e.sales})))),thickness:"small",size:"small",margin:{vertical:"small"}})),r.a.createElement(x.a,{effect:"solid"}))}},{property:"salesProfit",header:"Sales profit",render:function(e){return"$"+e.salesProfit}},{property:"childProfit",header:"Children's sales profit",render:function(e){return"$"+e.childProfit}},{property:"totalProfit",header:"Total profit",render:function(e){return"$"+e.totalProfit}}],data:f,primaryKey:"key",sortable:!0}))};function X(){var e=Object(o.a)(["\n  flex-shrink: 0;\n  width: 100vw;\n"]);return X=function(){return e},e}var Z=Object(u.default)(s.a).attrs({direction:"row",background:"beige",align:"center",pad:"small",responsive:!1,wrap:!0})(X()),ee=function(e){var t=e.stage,n=e.setStage,a=e.nextFriend;return r.a.createElement(Z,null,"select"===t?r.a.createElement(S.a,{margin:"small"},"Please select coordinates for",(null===a||void 0===a?void 0:a.parentCoords)?" child":" friend"):null,"tableEdit"!==t?r.a.createElement(E.a,{label:"select"===t?"Cancel":"Add Friend",onClick:function(){return n("select"===t?"normal":"select")},margin:"small"}):null,"select"!==t&&"tableEdit"!==t?r.a.createElement(E.a,{label:"Switch to "+(t.includes("table")?"Diagram":"Table")+" View",onClick:function(){return n(t.includes("table")?"normal":"table")},margin:"small"}):null,t.includes("table")?r.a.createElement(E.a,{label:"tableEdit"===t?"Done":"Edit Table",onClick:function(){return n("tableEdit"===t?"table":"tableEdit")},margin:"small"}):null,"select"!==t?r.a.createElement(E.a,{label:"rawInput"===t?"Back to Diagram View":"Input/Export",onClick:function(){return n("rawInput"===t?"normal":"rawInput")},margin:"small"}):null)},te=function(e){var t=e.setStage,n=e.nextFriend,a=n.coords,l=n.parentCoords,c=Object(C.a)({initialValues:{name:"",sales:""},onSubmit:function(){var e=Object(v.a)(d.a.mark((function e(n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l){e.next=3;break}return e.next=3,F.update(l,(function(e){var t=e.children,n=Object(p.a)(e,["children"]);return Object(h.a)(Object(h.a)({},n),{},{children:[].concat(Object(b.a)(t||[]),[a])})}));case 3:return e.next=5,F.add(a,n);case 5:t("normal");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onReset:function(){return t("normal")}});return r.a.createElement(k.a,{onEsc:c.handleReset,onClickOutside:c.handleReset},r.a.createElement("form",{onChange:c.handleChange,onSubmit:c.handleSubmit,onReset:c.handleReset},r.a.createElement(s.a,{justify:"center"},r.a.createElement(S.a,{textAlign:"center",margin:"small"},"Please input friend's values:"),r.a.createElement(s.a,{margin:"xsmall"},r.a.createElement(w.a,{placeholder:"Name",name:"name",autoFocus:!0})),r.a.createElement(s.a,{margin:"xsmall"},r.a.createElement(w.a,{placeholder:"Sales",name:"sales",type:"number"})),r.a.createElement(s.a,{direction:"row",justify:"center"},r.a.createElement(E.a,{label:"Cancel",type:"reset",margin:"small"}),r.a.createElement(E.a,{label:"Submit",type:"submit",margin:"small"})))))},ne=n(47);function ae(){var e=Object(o.a)(["\n  max-width: 100%;\n  max-height: 100%;\n  overflow: scroll;\n"]);return ae=function(){return e},e}var re=Object(u.default)(s.a).attrs({pad:"medium",justify:"center",align:"center",responsive:!1})(ae()),le=function(e){var t=e.setStage,n=Object(a.useRef)(),l=Object(a.useState)({}),c=Object(i.a)(l,2),o=c[0],u=c[1];Object(a.useEffect)((function(){F.getAll().then(u)}),[]);var m=Object(a.useCallback)((function(){var e=[["Name","Sales","Sales profit","Children's sales profit","Total profit"]].concat(Object(b.a)(Object.values(o).map((function(e){var t=e.name,n=e.sales,a=e.children;return[t,n,n*R.d,N({children:a}),n*R.d+N({children:a})]})))).map((function(e){return e.map((function(e){return'"'.concat(e,'"')})).join(",")})).join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8"});Object(ne.saveAs)(t,"friends_data_".concat(Math.round(Date.now()/1e3),".csv"))}),[o]),f=Object(a.useCallback)((function(){var e=JSON.stringify(Object.values(o),null,2),t=new Blob([e],{type:"application/json;charset=utf-8"});Object(ne.saveAs)(t,"friends_data_".concat(Math.round(Date.now()/1e3),".json"))}),[o]),d=Object(a.useCallback)((function(e){var n=function e(t,n,a){return t instanceof Object&&t.x<R.b&&t.y<R.c&&!isNaN(t.sales)&&t.name&&"string"===typeof t.name&&Array.isArray(t.children)&&t.children.every((function(t){return"string"===typeof t&&a.find((function(n){return t==="".concat(null===n||void 0===n?void 0:n.x,",").concat(null===n||void 0===n?void 0:n.y)&&e(n,null,a)}))||e(t)}))};if(e.target.files[0]){var a=new FileReader;a.onload=function(){try{var r=JSON.parse(a.result||"");if(Array.isArray(r)||(r=Object.values(r)),r.every(n)){var l={};r.forEach((function e(t){var n=t.name,a=t.sales,r=t.x,c=t.y,i=t.children;return l[[r,c]]={name:n,x:r,y:c,sales:Number(a),children:i.map((function(t){return"string"===typeof t?t:e(t)}))},[r,c].toString()})),window.confirm("Are you sure you want to load new values? This will delete everything and insert ".concat(Object.keys(l).length," value(s)."))&&F.replaceAll(l).then((function(){return t("normal")}))}else console.log("ERROR: BAD VALUES")}catch(e){console.log("ERROR: PARSING"),console.log(e)}},a.readAsText(e.target.files[0])}}),[t]);return r.a.createElement(re,null,r.a.createElement(E.a,{label:"Export CSV",onClick:m,margin:"small"}),r.a.createElement(s.a,{direction:"row"},r.a.createElement(E.a,{label:"Export JSON",onClick:f,margin:"small"}),r.a.createElement(E.a,{label:"Input JSON",onClick:function(){var e;return null===(e=n.current)||void 0===e?void 0:e.click()},margin:"small"}),r.a.createElement("input",{type:"file",ref:n,accept:"application/json",onChange:d,style:{display:"none"}})))};function ce(){var e=Object(o.a)(["\n  body {\n    margin: 0;\n  }\n"]);return ce=function(){return e},e}function ie(){var e=Object(o.a)(["\n  max-width: 100vw;\n  max-height: 100vh;\n"]);return ie=function(){return e},e}var oe=Object(u.default)(s.a)(ie()),ue=Object(u.createGlobalStyle)(ce()),se=function(){var e=Object(a.useState)("normal"),t=Object(i.a)(e,2),n=t[0],l=t[1],c=Object(a.useState)(null),o=Object(i.a)(c,2),u=o[0],s=o[1];return Object(a.useEffect)((function(){"normal"===n&&s(null)}),[n]),r.a.createElement(m.a,null,r.a.createElement(ue,null),r.a.createElement(oe,null,r.a.createElement(ee,{stage:n,setStage:l,nextFriend:u}),n.includes("table")?r.a.createElement(Q,{stage:n}):null,"rawInput"===n?r.a.createElement(le,{setStage:l}):null,n.includes("table")||"rawInput"===n?null:r.a.createElement(z,{stage:n,setStage:l,setNextFriend:s}),"input"===n?r.a.createElement(te,{setStage:l,nextFriend:u,setNextFriend:s}):null))};c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(se,null)),document.getElementById("root"))}},[[73,1,2]]]);
//# sourceMappingURL=main.31328826.chunk.js.map